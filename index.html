<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="google-site-verification" content="hnyb1jnM5Q6co65Dc7FMFxsxfL0wQ_aH1"><meta name="msvalidate.01" content="F2FFFBA1A6155C91A31EAC77F525BBD5"><meta name="baidu-site-verification" content="code-v7NaUITwkJ"><meta name="360-site-verification" content="cd75d354b11109d6f9f4ed94aff26cd6"><meta name="description" content="æ—¢ç„¶ç”Ÿæ´»è¿™ä¹ˆè‹¦ï¼Œé‚£è¿˜ä¸ç¬‘ä¸€ç¬‘è®©è‡ªå·±å¼€å¿ƒä¸€ç‚¹ã€‚"><meta property="og:type" content="website"><meta property="og:title" content="å°å…µçš„åšå®¢"><meta property="og:url" content="http://fxbing.github.io/index.html"><meta property="og:site_name" content="å°å…µçš„åšå®¢"><meta property="og:description" content="æ—¢ç„¶ç”Ÿæ´»è¿™ä¹ˆè‹¦ï¼Œé‚£è¿˜ä¸ç¬‘ä¸€ç¬‘è®©è‡ªå·±å¼€å¿ƒä¸€ç‚¹ã€‚"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="fxbing"><meta property="article:tag" content="æŠ€æœ¯,ç”Ÿæ´»"><meta name="twitter:card" content="summary"><title>å°å…µçš„åšå®¢</title><link ref="canonical" href="http://fxbing.github.io/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="dns-prefetch" href="https://hm.baidu.com"><script src="https://www.googletagmanager.com/gtag/js?id=139855287" async></script><script>function gtag(){dataLayer.push(arguments)}"localhost"!==window.location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","139855287"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e195e7c765ecde120b81d5afafa26e4b",e.async=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>var Stun=window.Stun||{},CONFIG={root:"/",algolia:void 0,assistSearch:void 0,fontIcon:{prompt:{success:"fas fa-check-circle",info:"fas fa-arrow-circle-right",warning:"fas fa-exclamation-circle",error:"fas fa-times-circle"},copyBtn:"fas fa-copy"},sidebar:{offsetTop:"20px",tocMaxDepth:6},header:void 0,postWidget:{endText:!0},nightMode:{enable:!0},back2top:{enable:!0},codeblock:{style:"carbon",highlight:"ocean",wordWrap:!1},reward:!1,fancybox:!1,zoomImage:{gapAside:"20px"},galleryWaterfall:void 0,lazyload:!1,pjax:void 0,externalLink:{icon:{enable:!0,name:"fas fa-external-link-alt"}},shortcuts:void 0,prompt:{copyButton:"å¤åˆ¶",copySuccess:"å¤åˆ¶æˆåŠŸ",copyError:"å¤åˆ¶å¤±è´¥"},sourcePath:{js:"js",css:"css",images:"images"}};window.CONFIG=CONFIG</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner header-inner--height header-inner--bgcolor"><nav class="header-nav header-nav--sticky"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">é¦–é¡µ</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">å½’æ¡£</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">æ ‡ç­¾</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">å…³äº</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/05/01/Kafka-%E5%92%8C-Pulsar-%E7%9A%84-Compaction-%E5%AE%9E%E7%8E%B0/">Kafka å’Œ Pulsar çš„ Compaction å®ç°</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2022-05-01</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2022-05-01</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>æœ¬æ–‡ä¸»è¦å¯¹ Kafka å’Œ Pulsar çš„ Log Compaction åŸç†è¿›è¡Œä»‹ç»ï¼Œå¹¶ä»¥æˆ‘çš„ç†è§£è¿›è¡Œç®€å•çš„å¯¹æ¯”è¯´æ˜ã€‚</p><p>&lt;â€“ more â€“&gt;</p><p>åœ¨ Kafka å’Œ Pulsar ä¸­ï¼Œéƒ½å…·å¤‡ Log Campactionï¼ˆæ—¥å¿—æŒ¤å‹ï¼‰çš„èƒ½åŠ›ï¼ŒCompaction ä¸åŒäº Log Compressionï¼ˆæ—¥å¿—å‹ç¼©ï¼‰ï¼ŒCompaction æ˜¯æŒ‡å°† Topic å†å²æ—¥å¿—ä¸­ç›¸åŒ Key çš„æ¶ˆæ¯åªä¿ç•™æœ€æ–°çš„ä¸€æ¡ï¼Œè€Œ Compression æ˜¯æŒ‡æ¶ˆæ¯ç»´åº¦åˆ©ç”¨å„ç§å‹ç¼©ç®—æ³•ï¼ˆå¦‚ï¼šgzipã€lz4ã€zstdç­‰ï¼‰å‡å°æ¶ˆæ¯å¤§å°ä½†ä¸æ”¹å˜æ¶ˆæ¯å†…å®¹ã€‚Compaction çš„ä½¿ç”¨åœºæ™¯çš„ç‰¹ç‚¹ï¼šä¸€æ˜¯æ¶ˆæ¯æœ‰ keyï¼ŒäºŒæ˜¯ç›¸åŒ key çš„æ¶ˆæ¯åªå…³å¿ƒæœ€æ–°çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼šè®°å½•æ¯æ”¯è‚¡ç¥¨ä»·æ ¼å˜åŠ¨çš„ Topicï¼Œè‚¡ç¥¨åç§°è®¾ç½®ä¸º keyï¼Œè‚¡ç¥¨ä»·æ ¼è®¾ç½®ä¸º valueï¼Œä¸€èˆ¬åªå…³å¿ƒè‚¡ç¥¨çš„æœ€æ–°ä»·æ ¼ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œé…ç½® Compaction å¯ä»¥è®© Topic å­˜å‚¨çš„æ•°æ®æ›´å°‘ï¼Œä»è€Œåœ¨éœ€è¦å…¨é‡è¯»å– Topic å†…å®¹æ—¶é€Ÿåº¦æ›´å¿«ã€‚</p><h2 id="Kafka-Log-Compaction"><a href="#Kafka-Log-Compaction" class="heading-link"><i class="fas fa-link"></i></a><a href="#Kafka-Log-Compaction" class="headerlink" title="Kafka Log Compaction"></a>Kafka Log Compaction</h2><blockquote><p>æœ¬æ–‡ä»‹ç»åŸºäº Kafka 2.8ï¼Œå¹¶ä¸”å¿½ç•¥äº†å¹‚ç­‰æ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯çš„ç›¸å…³å¤„ç†é€»è¾‘ï¼Œå¦‚æœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªè¡Œé˜…è¯»æºç äº†è§£ã€‚</p></blockquote><p>åœ¨ Kafka ä¸­ï¼ŒTopic é…ç½® <code>cleanup.policy</code>ç”¨æ¥æ§åˆ¶ Topic çš„æ•°æ®æ¸…ç†ç­–ç•¥ï¼Œè¯¥é…ç½®çš„å¯é€‰å€¼æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯<code>delete</code>ï¼Œè¡¨ç¤º Topic ä¸­æ•°æ®è¶…è¿‡ä¿ç•™æ—¶é—´æˆ–ä¿ç•™å¤§å°é™åˆ¶æ—¶ï¼Œç›´æ¥åˆ é™¤æœ€æ—§çš„æ•°æ®ï¼›å¦ä¸€ä¸ªæ˜¯<code>compact</code>ï¼Œè¡¨ç¤ºå¯¹äº Topic ä¸­çš„æ—§æ•°æ®ï¼ˆé Active Segment ä¸­çš„æ•°æ®ï¼‰æ‰§è¡ŒæŒ¤å‹ï¼Œä¸€å®šèŒƒå›´å†…ï¼Œå¯¹äº key ç›¸åŒï¼ˆæ²¡æœ‰ key çš„æ¶ˆæ¯ä¼šè¢«åˆ é™¤ï¼‰çš„æ¶ˆæ¯ï¼Œåªä¿ç•™æœ€æ–°çš„ä¸€æ¡ã€‚å¯¹äºæ¯ä¸ª Topic å¯ä»¥é€‰æ‹©ä¸€ç§æ¸…ç†ç­–ç•¥è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥åŒæ—¶é…ç½®ä¸¤ç§ç­–ç•¥ã€‚æœ¬æ–‡ä»‹ç»çš„æ˜¯ <code>compact</code>è¿™ä¸ªç­–ç•¥ï¼Œåœ¨ Kafka ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œç”¨æ¥å­˜æ”¾ commit offset ä¿¡æ¯çš„çš„å†…éƒ¨ Topic:<code>__consumer_offsets</code> ä¼šè¢«é…ç½®ä¸ºè¯¥ç­–ç•¥ï¼Œæ™®é€š Topic ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚</p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>å¯¹äºä¸€å° Kafka Brokerï¼Œ Log Compaction çš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»º LogCleanerï¼Œå¯åŠ¨é…ç½®æŒ‡å®šæ•°é‡çš„ CleanerThreadï¼Œè´Ÿè´£è¯¥ Broker çš„ Log Compactionã€‚</li><li>æ¯ä¸ª CleanerThread å¾ªç¯æ‰§è¡Œæ—¥å¿—æ¸…ç†å·¥ä½œï¼Œå¾ªç¯è¿‡ç¨‹å¦‚ä¸‹ï¼š<ol><li>å¯»æ‰¾ä¸€ä¸ªå¾…æ¸…ç†çš„ TopicPartitionã€‚</li><li>éå†è¯¥TopicPartition ä¸­æ‰€æœ‰å¾…æ¸…ç†çš„ Segmentï¼Œæ„é€  OffsetMap è®°å½•æ¯ä¸ª key æœ€æ–°çš„ offset åŠå¯¹åº”çš„æ¶ˆæ¯æ—¶é—´ã€‚</li><li>å¯¹è¯¥TopicPartition ä¸­æ‰€æœ‰å¾…æ¸…ç†çš„ Segment è¿›è¡Œåˆ†ç»„ï¼Œä¿è¯æ¯ç»„ Segment çš„ Log æ–‡ä»¶æ€»å¤§å°å’Œ Index æ–‡ä»¶æ€»å¤§å°ä¸ä¼šè¶…è¿‡ LogConfig å…è®¸çš„èŒƒå›´å¹¶ä¸”æ¯ç»„ Segment çš„ offset æå·®ä¸ä¼šè¶…è¿‡<code>Int.MaxValue</code>ï¼ˆKafka ä¸­ Segment å†…çš„ç›¸å¯¹ offset ä¸ºæ•´å‹ï¼Œè¿™ä¸ªæ£€æŸ¥æ˜¯ä¸ºäº†é¿å…ç›¸å¯¹ offset æº¢å‡ºï¼‰ã€‚</li><li>å°† Segment æŒ‰ç…§åˆ†å¥½çš„ç»„è¿›è¡Œæ¸…ç†ï¼Œæ¯ä¸€ç»„ Segment èšåˆä¸ºä¸€ä¸ªæ–°çš„ Segmentã€‚æ¯ç»„ Segment çš„æ¸…ç†è¿‡ç¨‹ä¸ºï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Segmentï¼Œç„¶åæ ¹æ® OffsetMap ä¸­è®°å½•çš„ä¿¡æ¯é€‰æ‹©éœ€è¦ä¿ç•™çš„æ¶ˆæ¯ï¼Œå­˜å…¥æ–° Segmentï¼Œæœ€åä½¿ç”¨æ–° Segment è¦†ç›–è¿™ä¸€ç»„æ—§ Segmentã€‚</li><li>å¯¹äºæ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆ Compaction æµç¨‹å¹¶ä¸”<code>cleanup.policy</code>é…ç½®åŒ…å«<code>compact</code>ç­–ç•¥çš„ Log è¿›è¡Œåˆ é™¤ï¼Œæœ¬æ¬¡åˆ é™¤ä¸æ˜¯å‰é¢ç”¨ä¸€ä¸ªæ–° Segment æ›¿æ¢ä¸€ç»„æ—§ Segment ä¸­çš„åˆ é™¤ï¼Œè€Œæ˜¯è°ƒç”¨<code>Log.deleteOldSegments</code>ã€‚è¯¥æ–¹æ³•ä¼šåˆ é™¤<code>LogStartOffset</code>ä¹‹å‰çš„æ‰€æœ‰ Segmentï¼Œå¦‚æœ<code>cleanup.policy</code>é…ç½®åŒæ—¶è¿˜åŒ…å«<code>delete</code>ç­–ç•¥ï¼Œä¹Ÿä¼šåˆ é™¤è¶…è¿‡ä¿ç•™æ—¶é—´æˆ–ä¿ç•™å¤§å°é™åˆ¶çš„ Segmentã€‚</li></ol></li></ol><h3 id="è¯¦ç»†è¯´æ˜"><a href="#è¯¦ç»†è¯´æ˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#è¯¦ç»†è¯´æ˜" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h3><p>ä¸‹é¢ä»¥Q&amp;Açš„æ–¹å¼ä»‹ç»æ—¥å¿—æ¸…ç†çš„ç»†èŠ‚å’Œé€»è¾‘ï¼š</p><h4 id="å¤šä¸ª-CleanerThread-æ˜¯å¦‚ä½•ä¿è¯-Compaction-è¿‡ç¨‹çº¿ç¨‹å®‰å…¨çš„"><a href="#å¤šä¸ª-CleanerThread-æ˜¯å¦‚ä½•ä¿è¯-Compaction-è¿‡ç¨‹çº¿ç¨‹å®‰å…¨çš„" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¤šä¸ª-CleanerThread-æ˜¯å¦‚ä½•ä¿è¯-Compaction-è¿‡ç¨‹çº¿ç¨‹å®‰å…¨çš„" class="headerlink" title="å¤šä¸ª CleanerThread æ˜¯å¦‚ä½•ä¿è¯ Compaction è¿‡ç¨‹çº¿ç¨‹å®‰å…¨çš„?"></a>å¤šä¸ª CleanerThread æ˜¯å¦‚ä½•ä¿è¯ Compaction è¿‡ç¨‹çº¿ç¨‹å®‰å…¨çš„?</h4><p>Kafka ä¸­ Log Compaction çš„å®ç°ä¸»è¦æ˜¯<code>LogCleaner</code>å’Œ<code>LogCleanerManager</code>ä¸¤ä¸ªç±»ï¼Œ<code>LogCleaner</code>æ˜¯ Compaction å·¥ä½œçš„ä¸»ç±»ï¼Œè´Ÿè´£æ•´ä½“çš„å·¥ä½œæµç¨‹ï¼Œ<code>LogCleanerManager</code>è´Ÿè´£ Compaction çŠ¶æ€æœºçš„ç®¡ç†ã€‚æ‰€æœ‰çŠ¶æ€å¦‚ä¸‹ï¼š</p><p><img src="https://s3.bmp.ovh/imgs/2022/04/29/52b607617aa123f4.png"></p><ol><li><code>None</code> ï¼šTopicPartition æœªæ¸…ç†çŠ¶æ€ã€‚</li><li><code>LogCleaningInProgress</code> ï¼šæ¸…ç†æ­£åœ¨è¿›è¡Œä¸­ï¼Œå½“ TopicPartition è¢«é€‰ä¸­ä¸ºå¾…æ¸…ç† Log æ—¶ä¼šå˜ä¸ºè¯¥çŠ¶æ€ã€‚</li><li><code>LogCleaningAborted</code> ï¼šæ¸…ç†ä¸­æ­¢ï¼Œè¿™æ˜¯ä¸€ä¸ªä»<code>LogCleaningInProgress</code>åˆ°<code>LogCleaningPaused(1)</code>çš„ä¸­é—´çŠ¶æ€ï¼Œåœ¨å¤–éƒ¨å‘ç”Ÿ truncateã€åç›˜ç­‰æƒ…å†µæ—¶éœ€è¦æ”¾å¼ƒç°åœ¨æ­£åœ¨çš„æ¸…ç†æ“ä½œï¼Œ ç»ˆæ­¢åè¯¥ TopicPartition ä¼šæ ‡è®°ä¸º <code>LogCleaningAborted</code>ã€‚</li><li><code>LogCleaningPaused(i)</code>ï¼šæ¸…ç†æš‚åœï¼Œi çš„åˆå§‹å€¼ä¸º1ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å…¥çš„çŠ¶æ€ï¼Œå³ï¼šå¦‚æœå½“å‰çŠ¶æ€æ˜¯<code>LogCleaningPaused(i)</code>ï¼Œå†æ¬¡æš‚åœè¯¥ TopicPartition çš„è¯ï¼ŒçŠ¶æ€ä¼šå˜ä¸º<code>LogCleaningPaused(i+1)</code>ï¼Œä»æš‚åœçŠ¶æ€æ¢å¤çš„è¯ï¼ŒçŠ¶æ€ä¼šå˜ä¸º<code>LogCleaningPaused(i-1)</code>ï¼ˆi-1=0 æ—¶ç›´æ¥å˜ä¸º<code>None</code>çŠ¶æ€ï¼‰ã€‚ä¼šè§¦å‘çŠ¶æ€å˜ä¸º<code>LogCleaningPaused(i)</code>çš„æƒ…å†µå¦‚ä¸‹ï¼ˆä¸‹é¢çš„â€œæš‚åœâ€å’Œâ€œæš‚åœæ¢å¤â€åˆ†åˆ«ä»£è¡¨ i + 1 å’Œ i - 1ï¼‰ï¼š<ol><li>Topic é…ç½®<code>cleanup.policy</code>ä¸åŒ…å«<code>compact</code>ï¼šæš‚åœ</li><li>å¤–éƒ¨å‘ç”Ÿ truncateã€åç›˜ç­‰æƒ…å†µæ—¶è¯¥ TopicPartition çŠ¶æ€ä¸º<code>None</code>æˆ–<code>LogCleaningPaused(i)</code>ï¼šæš‚åœ</li><li>æœ¬è½®æ¸…ç†å®Œæˆä¸”è¯¥ TopicPartition çŠ¶æ€ä¸º<code>LogCleaningAborted</code>ï¼šæš‚åœ</li><li>è§¦å‘æš‚åœçš„æ“ä½œå®Œæˆï¼šæš‚åœæ¢å¤</li></ol></li></ol><blockquote><p>æˆ‘ç†è§£ä¸­æ­¢çŠ¶æ€å’Œæš‚åœçŠ¶æ€çš„åŒºåˆ«æ˜¯ï¼šæ˜¯å¦å¯ä»¥åœ¨æœ¬è½®æ¸…ç†ä¸­æ¢å¤ã€‚åœ¨å¤–éƒ¨å‘ç”Ÿ truncateã€åç›˜ç­‰æƒ…å†µæ—¶ï¼Œå¦‚æœä¸€ä¸ª TopicPartition æ²¡æœ‰å¤„äºæ¸…ç†è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ ‡è®°ä¸ºæš‚åœï¼Œåœ¨è§¦å‘æš‚åœçš„æƒ…å†µç»“æŸåï¼Œæ¢å¤æ¸…ç†æµç¨‹å°±ä¼šé‡æ–°æ‰§è¡Œæ¸…ç†æµç¨‹ã€‚ä½†æ˜¯å¦‚æœè¯¥ TopicPartition å¤„äºæ¸…ç†è¿‡ç¨‹ä¸­ï¼Œåˆ™å¿…é¡»æ ‡è®°ä¸ºç»ˆæ­¢ï¼Œåœ¨è§¦å‘æš‚åœçš„æƒ…å†µç»“æŸåï¼Œå³ä½¿æœ¬è½®æ¸…ç†æ²¡ç»“æŸï¼Œä¹Ÿå¿…é¡»è¦å…ˆæ ‡è®°ä¸ºæš‚åœï¼Œåœ¨ä¸‹è½®æ“ä½œè¿›è¡Œæ¸…ç†ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœå·²ç»åœ¨æ¸…ç†è¿‡ç¨‹ä¸­äº†ï¼Œæœ¬è½®æ¸…ç†ä¼šæœ‰ä¸€äº›ä¸­é—´æ€çš„ä¿¡æ¯ï¼Œä¸å®¹æ˜“ä»ä¸­é—´æ€è¿›è¡Œæ¢å¤ã€‚</p></blockquote><p>å¯¹äºæ¯ä¸ª CleanerThreadï¼Œæ¯æ¬¡éƒ½ä¼šé€šè¿‡<code>LogCleanerManager.grabFilthiestCompactedLog</code>æ–¹æ³•æ¥æœç´¢çŠ¶æ€ä¸º<code>None</code>å¹¶ä¸”éœ€è¦è¢«æ¸…ç†çš„ TopicPartition è¿›è¡Œæ¸…ç†ã€‚<code>LogCleanerManager</code>ä¸­çš„æ‰€æœ‰çŠ¶æ€å˜æ›´éƒ½ä¼šåŠ é”ï¼Œä¿è¯çŠ¶æ€æœºæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ª CleanerThread é€šè¿‡è¯¥çŠ¶æ€æœºä¿è¯äº†æ‰€æœ‰ TopicPartition çš„ Compaction è¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h4 id="å¦‚ä½•å†³å®šå“ªäº›-TopicPartition-åº”è¯¥è¢«æ¸…ç†ï¼ˆLogCleanerManager-grabFilthiestCompactedLogçš„è¯¦ç»†æµç¨‹ï¼‰"><a href="#å¦‚ä½•å†³å®šå“ªäº›-TopicPartition-åº”è¯¥è¢«æ¸…ç†ï¼ˆLogCleanerManager-grabFilthiestCompactedLogçš„è¯¦ç»†æµç¨‹ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¦‚ä½•å†³å®šå“ªäº›-TopicPartition-åº”è¯¥è¢«æ¸…ç†ï¼ˆLogCleanerManager-grabFilthiestCompactedLogçš„è¯¦ç»†æµç¨‹ï¼‰" class="headerlink" title="å¦‚ä½•å†³å®šå“ªäº› TopicPartition åº”è¯¥è¢«æ¸…ç†ï¼ˆLogCleanerManager.grabFilthiestCompactedLogçš„è¯¦ç»†æµç¨‹ï¼‰?"></a>å¦‚ä½•å†³å®šå“ªäº› TopicPartition åº”è¯¥è¢«æ¸…ç†ï¼ˆ<code>LogCleanerManager.grabFilthiestCompactedLog</code>çš„è¯¦ç»†æµç¨‹ï¼‰?</h4><p>å¯ä»¥æ¸…ç†çš„ TopicPartition é™åˆ¶æ¡ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><p>Topic é…ç½®<code>cleanup.policy</code>åŒ…å«<code>compact</code>ã€‚</p></li><li><p>TopicPartition çš„çŠ¶æ€ä¸ºç©ºï¼šè¯´æ˜æ²¡æœ‰å…¶ä»– CleanerThread æ“ä½œè¯¥ TopicPartitionã€‚</p></li><li><p>è¯¥ TopicPartition æ˜¯å¯ä»¥æ¸…ç†çš„ï¼šå› ä¸ºåç›˜ç­‰é—®é¢˜æŸäº› TopicPartition ä¼šè¢«æ ‡è®°ä¸ºä¸å¯æ¸…ç†ï¼Œéœ€è¦è·³è¿‡ã€‚</p></li><li><p>ä¸éœ€è¦å»¶è¿Ÿæ¸…ç†ï¼šæ¶ˆæ¯åœ¨æ—¥å¿—ä¸­å¿…é¡»å­˜åœ¨<code>&quot;max.compaction.lag.ms&quot;</code>æŒ‡å®šçš„æ—¶é—´åæ‰èƒ½è¢«åˆ é™¤ï¼ˆè¯¦æƒ…å¯å‚è€ƒ<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-354">KIP-354</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>ï¼‰ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæœªå‹ç¼© Segment çš„ä¼°è®¡æœ€æ—©æ¶ˆæ¯æ—¶é—´æˆ³æ—©äº<code>&quot;max.compaction.lag.ms&quot;</code>æ‰ä¼šå¯ä»¥è¿›è¡Œ Compactionã€‚</p></li><li><p>éœ€è¦è¢«æ¸…ç†çš„æ¶ˆæ¯æ€»å¤§å°å¤§äº0ï¼šä» LogStartOffset æˆ– CleanCheckPoint å¼€å§‹åˆ°æ»¡è¶³<code>&quot;max.compaction.lag.ms&quot;</code>é…ç½®è¦æ±‚çš„ offset ä¹‹é—´çš„æ¶ˆæ¯æ€»å¤§å°</p></li><li><p>æ»¡è¶³æ¸…ç†é¢‘ç‡æ»¡è¶³è¦æ±‚ï¼šæœ‰å…³æ¸…ç†é¢‘ç‡çš„é…ç½®å¯ä»¥ç›´æ¥çœ‹ä¸‹é¢æºç  Doc</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIN_COMPACTION_LAG_MS_CONFIG = <span class="string">&quot;min.compaction.lag.ms&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIN_COMPACTION_LAG_MS_DOC = <span class="string">&quot;The minimum time a message will remain &quot;</span> +</span><br><span class="line">    <span class="string">&quot;uncompacted in the log. Only applicable for logs that are being compacted.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_COMPACTION_LAG_MS_CONFIG = <span class="string">&quot;max.compaction.lag.ms&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_COMPACTION_LAG_MS_DOC = <span class="string">&quot;The maximum time a message will remain &quot;</span> +</span><br><span class="line">    <span class="string">&quot;ineligible for compaction in the log. Only applicable for logs that are being compacted.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIN_CLEANABLE_DIRTY_RATIO_CONFIG = <span class="string">&quot;min.cleanable.dirty.ratio&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIN_CLEANABLE_DIRTY_RATIO_DOC = <span class="string">&quot;This configuration controls how frequently &quot;</span> +</span><br><span class="line">    <span class="string">&quot;the log compactor will attempt to clean the log (assuming &lt;a href=\&quot;#compaction\&quot;&gt;log &quot;</span> +</span><br><span class="line">    <span class="string">&quot;compaction&lt;/a&gt; is enabled). By default we will avoid cleaning a log where more than &quot;</span> +</span><br><span class="line">    <span class="string">&quot;50% of the log has been compacted. This ratio bounds the maximum space wasted in &quot;</span> +</span><br><span class="line">    <span class="string">&quot;the log by duplicates (at 50% at most 50% of the log could be duplicates). A &quot;</span> +</span><br><span class="line">    <span class="string">&quot;higher ratio will mean fewer, more efficient cleanings but will mean more wasted &quot;</span> +</span><br><span class="line">    <span class="string">&quot;space in the log. If the &quot;</span> + MAX_COMPACTION_LAG_MS_CONFIG + <span class="string">&quot; or the &quot;</span> + MIN_COMPACTION_LAG_MS_CONFIG +</span><br><span class="line">    <span class="string">&quot; configurations are also specified, then the log compactor considers the log to be eligible for compaction &quot;</span> +</span><br><span class="line">    <span class="string">&quot;as soon as either: (i) the dirty ratio threshold has been met and the log has had dirty (uncompacted) &quot;</span> +</span><br><span class="line">    <span class="string">&quot;records for at least the &quot;</span> + MIN_COMPACTION_LAG_MS_CONFIG + <span class="string">&quot; duration, or (ii) if the log has had &quot;</span> +</span><br><span class="line">    <span class="string">&quot;dirty (uncompacted) records for at most the &quot;</span> + MAX_COMPACTION_LAG_MS_CONFIG + <span class="string">&quot; period.&quot;</span>;</span><br></pre></td></tr></table></div></figure></li></ul><h4 id="OffsetMap-çš„å®ç°åŸç†"><a href="#OffsetMap-çš„å®ç°åŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#OffsetMap-çš„å®ç°åŸç†" class="headerlink" title="OffsetMap çš„å®ç°åŸç†"></a>OffsetMap çš„å®ç°åŸç†</h4><p>OffsetMap çš„å®ç°ç±»æ˜¯<code>SkimpyOffsetsMap</code>ï¼Œç”¨æ¥å­˜å‚¨ message key å’Œ offset çš„æ˜ å°„å…³ç³»ï¼Œç”¨æ¥ä¿å­˜ç›¸åŒ key ä¸‹æœ€æ–°æ¶ˆæ¯çš„ Offsetã€‚æ­¤å¤„ä¸ä»‹ç»è¯¥ç±»çš„è¯¦ç»†å®ç°ï¼ˆæ„Ÿå…´è¶£è‡ªè¡Œé˜…è¯»<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/apache/kafka/blob/2.8/core/src/main/scala/kafka/log/OffsetMap.scala">æºç </a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>ï¼‰ï¼Œåªåˆ—ä¸¾å…¶ç‰¹ç‚¹ï¼š</p><ul><li>åˆ›å»ºæ—¶éœ€è¦æŒ‡å®šä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ memoryï¼Œç”¨æ¥æŒ‡å®šå­˜å‚¨ offset çš„ ByteBuffer å¤§å°ï¼Œå¦ä¸€ä¸ªæ˜¯ hashAlgorithmï¼Œç”¨æ¥ç¡®å®šè®¡ç®— key hash æ—¶ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ã€‚</li><li>åªå…è®¸å¢åŠ ï¼Œä¸å…è®¸åˆ é™¤ã€‚</li><li>åªåœ¨ ByteBuffer ä¸­å­˜å‚¨éœ€è¦è®°å½•çš„ offsetï¼Œæ¯æ¬¡ put/get éƒ½æ˜¯å…ˆå¯¹ key hash ç¡®å®š positionï¼Œç„¶åç›´æ¥ä¿®æ”¹/è¯»å– ByteBuffer ä¸­çš„å†…å®¹ã€‚</li></ul><blockquote><p>æˆ‘ç†è§£è¯¥å®ç°çš„ä¸»è¦ä¼˜ç‚¹æ˜¯é¿å…å­˜å‚¨ message keyï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚</p></blockquote><h4 id="å¦‚ä½•ä»ä¸€ç»„æ—§çš„-Segment-ä¸­è¿‡æ»¤å‡ºéœ€è¦ä¿ç•™çš„æ¶ˆæ¯ä»¥åŠè¿‡æ»¤ç­–ç•¥æ˜¯æ€æ ·çš„"><a href="#å¦‚ä½•ä»ä¸€ç»„æ—§çš„-Segment-ä¸­è¿‡æ»¤å‡ºéœ€è¦ä¿ç•™çš„æ¶ˆæ¯ä»¥åŠè¿‡æ»¤ç­–ç•¥æ˜¯æ€æ ·çš„" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¦‚ä½•ä»ä¸€ç»„æ—§çš„-Segment-ä¸­è¿‡æ»¤å‡ºéœ€è¦ä¿ç•™çš„æ¶ˆæ¯ä»¥åŠè¿‡æ»¤ç­–ç•¥æ˜¯æ€æ ·çš„" class="headerlink" title="å¦‚ä½•ä»ä¸€ç»„æ—§çš„ Segment ä¸­è¿‡æ»¤å‡ºéœ€è¦ä¿ç•™çš„æ¶ˆæ¯ä»¥åŠè¿‡æ»¤ç­–ç•¥æ˜¯æ€æ ·çš„?"></a>å¦‚ä½•ä»ä¸€ç»„æ—§çš„ Segment ä¸­è¿‡æ»¤å‡ºéœ€è¦ä¿ç•™çš„æ¶ˆæ¯ä»¥åŠè¿‡æ»¤ç­–ç•¥æ˜¯æ€æ ·çš„?</h4><p>è¿‡æ»¤æ¶ˆæ¯çš„æµç¨‹æ˜¯ï¼Œå…ˆå°†æ—§ Segment ä¸­çš„æ¶ˆæ¯è¯»å…¥MemoryRecordsï¼Œç„¶åä½¿ç”¨<code>MemoryRecords.filterTo</code>æ–¹æ³•è¿›è¡Œè¿‡æ»¤ï¼Œè¯¥æ–¹æ³•æ”¯æŒä½¿ç”¨è‡ªå®šä¹‰å®ç°çš„ <code>RecordFilter</code> è¿‡æ»¤æ¶ˆæ¯ã€‚</p><p>æ¶ˆæ¯è¿‡æ»¤çš„ç­–ç•¥ï¼ˆå®é™…ä¼šæœ‰äº‹åŠ¡æ¶ˆæ¯çš„å¤„ç†ï¼‰æ˜¯ï¼šè¿‡æ»¤æ‰ç›¸åŒ key ä¸­éæœ€æ–° offset çš„æ¶ˆæ¯ä»¥åŠæ»¡è¶³åˆ é™¤æ¡ä»¶çš„<strong>å¢“ç¢‘æ¶ˆæ¯</strong>ï¼ˆkey ä¸ä¸º null ä½†æ˜¯ value ä¸º nullï¼‰ã€‚å¢“ç¢‘æ¶ˆæ¯çš„åˆ é™¤æ¡ä»¶æ˜¯æŒ‡ï¼Œè¯¥å¢“ç¢‘æ¶ˆæ¯æ‰€åœ¨çš„ Segment æœ€åä¿®æ”¹æ—¶é—´è·ç¦»æœ€æ–° Segment çš„æœ€åä¿®æ”¹æ—¶é—´è¶…è¿‡<code>delete.retention.ms</code>é…ç½®çš„æ—¶é—´ã€‚</p><h4 id="å¦‚æœ-Compaction-è¿‡ç¨‹ä¸­-Broker-å´©æºƒï¼Œé‡å¯åå¦‚ä½•æ¢å¤"><a href="#å¦‚æœ-Compaction-è¿‡ç¨‹ä¸­-Broker-å´©æºƒï¼Œé‡å¯åå¦‚ä½•æ¢å¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¦‚æœ-Compaction-è¿‡ç¨‹ä¸­-Broker-å´©æºƒï¼Œé‡å¯åå¦‚ä½•æ¢å¤" class="headerlink" title="å¦‚æœ Compaction è¿‡ç¨‹ä¸­ Broker å´©æºƒï¼Œé‡å¯åå¦‚ä½•æ¢å¤?"></a>å¦‚æœ Compaction è¿‡ç¨‹ä¸­ Broker å´©æºƒï¼Œé‡å¯åå¦‚ä½•æ¢å¤?</h4><p>å®•æœºæ¢å¤çš„è€ƒè™‘åªå‘ç”Ÿåœ¨ç”¨æ–° Segmentï¼ˆæ–‡ä»¶ååç¼€æ˜¯<code>.cleaned</code>ï¼‰ æ›¿æ¢æ—§ Segment çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–é˜¶æ®µå‘ç”Ÿå®•æœºçš„è¯ï¼Œæ¢å¤åé‡æ–°æ‰§è¡Œ Compaction æµç¨‹å³å¯ã€‚</p><p>Segment æ›¿æ¢æ“ä½œä½¿ç”¨<code>replaceSegments</code>æ–¹æ³•ï¼ˆæºç å¦‚ä¸‹ï¼‰å®Œæˆï¼Œæ›¿æ¢æµç¨‹æ˜¯ï¼š</p><ol><li>å°†æ–° Segment çš„æ–‡ä»¶ååç¼€ä»<code>.cleaned</code>æ”¹ä¸º<code>.swap</code></li><li>åˆ é™¤æ—§ Segmentï¼šåˆ é™¤è¿‡ç¨‹æ˜¯å…ˆå°†åŒæ­¥å°†æ–‡ä»¶åç¼€æ”¹ä¸º<code>.deleted</code>ï¼Œç„¶åè¿›è¡Œå¼‚æ­¥åˆ é™¤</li><li>å»æ‰æ–° Segment çš„æ–‡ä»¶ååç¼€ï¼Œæµç¨‹ç»“æŸ</li></ol><p>ä¸‹é¢æ˜¯å¯¹äºæ‰€æœ‰å¯èƒ½çš„é˜¶æ®µ Broker å´©æºƒåçš„æ¢å¤é€»è¾‘ï¼š</p><ul><li>æ­¥éª¤1ä¹‹å‰ï¼šå¦‚æœæ­¤æ—¶ broker å´©æºƒï¼Œåˆ™æ¸…ç†å’Œäº¤æ¢æ“ä½œå°†ä¸­æ­¢ï¼Œå¹¶ä¸”åœ¨ <code>loadSegments()</code>ä¸­æ¢å¤æ—¶åˆ é™¤ <code>.cleaned</code> æ–‡ä»¶ã€‚</li><li>æ­¥éª¤1æ‰§è¡Œè¿‡ç¨‹ä¸­å´©æºƒï¼šæ–° Segment é‡å‘½åä¸º <code>.swap</code>ã€‚å¦‚æœä»£ç†åœ¨æ‰€æœ‰ Segment é‡å‘½åä¸º <code>.swap</code> ä¹‹å‰å´©æºƒï¼Œåˆ™æ¸…ç†å’Œäº¤æ¢æ“ä½œå°†ä¸­æ­¢ <code>.cleaned</code> ä»¥åŠ <code>.swap</code> æ–‡ä»¶åœ¨ <code>loadSegments()</code> æ¢å¤æ—¶è¢«åˆ é™¤ã€‚ <code>.cleaned</code> é‡å‘½åä¸º <code>.swap</code> æ˜¯æŒ‰ç…§æ–‡ä»¶æŒ‰åç§»é‡çš„é™åºè¿›è¡Œçš„ï¼Œæ¢å¤æ—¶ï¼Œæ‰€æœ‰åç§»é‡å¤§äºæœ€å°åç§»é‡ <code>.clean</code>æ–‡ä»¶çš„<code>.swap</code> æ–‡ä»¶éƒ½å°†è¢«åˆ é™¤ã€‚</li><li>æ­¥éª¤1å®Œæˆåå´©æºƒï¼šå¦‚æœåœ¨æ‰€æœ‰æ–° Segment é‡å‘½åä¸º <code>.swap</code> åä»£ç†å´©æºƒï¼Œåˆ™æ“ä½œå®Œæˆï¼Œå‰©ä½™æ“ä½œæµç¨‹ä¼šåœ¨ Broker æ¢å¤æ—¶ç»§ç»­æ‰§è¡Œã€‚</li><li>æ­¥éª¤2æ‰§è¡Œè¿‡ç¨‹ä¸­å´©æºƒï¼šæ—§ Segment æ–‡ä»¶è¢«é‡å‘½åä¸º <code>.deleted</code> å¹¶å®‰æ’äº†å¼‚æ­¥åˆ é™¤ã€‚å¦‚æœ Broker å´©æºƒï¼Œä»»ä½•ç•™ä¸‹çš„ <code>.deleted</code> æ–‡ä»¶éƒ½ä¼šåœ¨ <code>loadSegments()</code> æ¢å¤æ—¶è¢«åˆ é™¤ï¼Œç„¶åè°ƒç”¨ <code>replaceSegments()</code> ä»¥å®Œæˆæ›¿æ¢ï¼Œå…¶ä¸­æ–° Segment ä» <code>.swap</code> æ–‡ä»¶é‡æ–°åˆ›å»ºï¼Œæ—§ Segment åŒ…å«åœ¨å´©æºƒå‰æœªé‡å‘½åçš„ Segmentã€‚</li><li>æ­¥éª¤3å®Œæˆåå´©æºƒï¼šæ­¤æ—¶å¯èƒ½å­˜åœ¨æœªè¢«å¼‚æ­¥åˆ é™¤å®Œæˆçš„æ—§ Segmentï¼Œä»»ä½•å¯èƒ½ç•™ä¸‹çš„ <code>.deleted</code> æ–‡ä»¶éƒ½ä¼šåœ¨ <code>loadSegments()</code> æ¢å¤æ—¶è¢«åˆ é™¤</li></ul><figure class="highlight scala"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[log] <span class="function"><span class="keyword">def</span> <span class="title">replaceSegments</span></span>(newSegments: <span class="type">Seq</span>[<span class="type">LogSegment</span>], oldSegments: <span class="type">Seq</span>[<span class="type">LogSegment</span>], isRecoveredSwapFile: <span class="type">Boolean</span> = <span class="literal">false</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    lock synchronized &#123;</span><br><span class="line">      <span class="keyword">val</span> sortedNewSegments = newSegments.sortBy(_.baseOffset)</span><br><span class="line">      <span class="comment">// Some old segments may have been removed from index and scheduled for async deletion after the caller reads segments</span></span><br><span class="line">      <span class="comment">// but before this method is executed. We want to filter out those segments to avoid calling asyncDeleteSegment()</span></span><br><span class="line">      <span class="comment">// multiple times for the same segment.</span></span><br><span class="line">      <span class="keyword">val</span> sortedOldSegments = oldSegments.filter(seg =&gt; segments.containsKey(seg.baseOffset)).sortBy(_.baseOffset)</span><br><span class="line"></span><br><span class="line">      checkIfMemoryMappedBufferClosed()</span><br><span class="line">      <span class="comment">// need to do this in two phases to be crash safe AND do the delete asynchronously</span></span><br><span class="line">      <span class="comment">// if we crash in the middle of this we complete the swap in loadSegments()</span></span><br><span class="line">      <span class="keyword">if</span> (!isRecoveredSwapFile)</span><br><span class="line">        sortedNewSegments.reverse.foreach(_.changeFileSuffixes(<span class="type">Log</span>.<span class="type">CleanedFileSuffix</span>, <span class="type">Log</span>.<span class="type">SwapFileSuffix</span>))</span><br><span class="line">      sortedNewSegments.reverse.foreach(addSegment(_))</span><br><span class="line">      <span class="keyword">val</span> newSegmentBaseOffsets = sortedNewSegments.map(_.baseOffset).toSet</span><br><span class="line"></span><br><span class="line">      <span class="comment">// delete the old files</span></span><br><span class="line">      sortedOldSegments.foreach &#123; seg =&gt;</span><br><span class="line">        <span class="comment">// remove the index entry</span></span><br><span class="line">        <span class="keyword">if</span> (seg.baseOffset != sortedNewSegments.head.baseOffset)</span><br><span class="line">          segments.remove(seg.baseOffset)</span><br><span class="line">        <span class="comment">// delete segment files, but do not delete producer state for segment objects which are being replaced.</span></span><br><span class="line">        deleteSegmentFiles(<span class="type">List</span>(seg), asyncDelete = <span class="literal">true</span>, deleteProducerStateSnapshots = !newSegmentBaseOffsets.contains(seg.baseOffset))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// okay we are safe now, remove the swap suffix</span></span><br><span class="line">      sortedNewSegments.foreach(_.changeFileSuffixes(<span class="type">Log</span>.<span class="type">SwapFileSuffix</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></div></figure><hr><h2 id="Pulsar-Compaction"><a href="#Pulsar-Compaction" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pulsar-Compaction" class="headerlink" title="Pulsar Compaction"></a>Pulsar Compaction</h2><p>Pulsar å®˜æ–¹æ–‡æ¡£ä¸­å…³äº Compaction çš„ä»‹ç»ä¹Ÿæ¯”è¾ƒè¯¦ç»†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼š</p><ul><li><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://pulsar.apache.org/docs/zh-CN/next/concepts-topic-compaction/#compaction">https://pulsar.apache.org/docs/zh-CN/next/concepts-topic-compaction/#compaction</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://pulsar.apache.org/docs/zh-CN/next/cookbooks-compaction/">https://pulsar.apache.org/docs/zh-CN/next/cookbooks-compaction/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/ivankelly/incubator-pulsar-wiki/blob/pip-9/PIP-9:-Topic-Compaction.md">https://github.com/ivankelly/incubator-pulsar-wiki/blob/pip-9/PIP-9:-Topic-Compaction.md</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ul><p>åœ¨ Pulsar ä¸­ï¼ŒTopic Compaction ä¸ NonCompaction ä¸¤ä¸ªçŠ¶æ€ä¸æ˜¯ç›¸äº’å¯¹ç«‹çš„ï¼ŒCompaction æ˜¯é€šè¿‡ç±»ä¼¼äºåˆ›å»ºä¸€ä¸ªSubscription æ¥æ¶ˆè´¹ç°æœ‰ Topic çš„æ¶ˆæ¯ï¼Œç»è¿‡ Compaction å¤„ç†åï¼Œå†™å…¥æ–°çš„ Ledger å­˜å‚¨ï¼Œåœ¨ Consumer æ¶ˆè´¹æ—¶ï¼Œå¯ä»¥é€šè¿‡é…ç½®é€‰æ‹©è¯»å– Compacted æ•°æ®è¿˜æ˜¯ NonCompacted æ•°æ®ã€‚æ³¨æ„ï¼šCompact åªèƒ½å¯¹ persistent topic æ‰§è¡Œã€‚</p><h3 id="è§¦å‘æ¡ä»¶"><a href="#è§¦å‘æ¡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#è§¦å‘æ¡ä»¶" class="headerlink" title="è§¦å‘æ¡ä»¶"></a>è§¦å‘æ¡ä»¶</h3><p>Pulsar ä¸­è§¦å‘ Topic Compaction çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ol><li>é…ç½®<code>CompactionThreshold</code>ï¼šå¦‚å‰é¢æ‰€è¯´ï¼ŒCompaction è¿‡ç¨‹ç›¸å½“äºå»ºç«‹ä¸€ä¸ª Subscription æ¥æ¶ˆè´¹åŸæ¥ Topic ä¸­çš„æ•°æ®å†™å…¥æ–°çš„ Ledgerï¼ŒBroker ä¼šå‘¨æœŸæ€§æ£€æŸ¥æ‰€æœ‰ Persistent Topicï¼Œå¦‚æœ<code>CompactionThreshold</code>é…ç½®ä¸ä¸º0å¹¶ä¸”è¿™ä¸ª Subscription çš„æ¶ˆæ¯ç§¯å‹è¶…è¿‡äº†é…ç½®çš„é˜ˆå€¼ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ Compactionã€‚è¿™ä¸ªé…ç½®çš„ç²’åº¦å¯ä»¥æ˜¯ topicã€brokerã€namespaceï¼Œæœ€ç»ˆæ ¹æ®ä¼˜å…ˆçº§ï¼ˆtopic &gt; broker &gt; namespaceï¼‰ç¡®å®šæœ€ç»ˆé…ç½®å€¼ã€‚</li><li>å¤–éƒ¨è§¦å‘ Topic Compactionï¼šé™¤è‡ªåŠ¨è§¦å‘ Compaction å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ CLI å·¥å…·è§¦å‘ï¼Œä¸€ç§æ˜¯ AdminCliï¼Œéœ€è¦è°ƒç”¨ broker æä¾›çš„ RestAPIï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ä¸“ç”¨å·¥å…·ç±»ï¼Œä¸ç»è¿‡ RestAPI ç›´æ¥æŒ‡å®šã€‚</li></ol><figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/pulsar-admin topics compact persistent://my-tenant/my-namespace/my-topic <span class="comment"># AdminCli</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> bin/pulsar compact-topic --topic persistent://my-tenant-namespace/my-topic <span class="comment"># ä¸“ç”¨å·¥å…·</span></span></span><br></pre></td></tr></table></div></figure><h3 id="å®ç°åŸç†-1"><a href="#å®ç°åŸç†-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#å®ç°åŸç†-1" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>å®ç°åŸç†æ€»ä½“å¯ä»¥åˆ†ä¸º Compaction çš„å¤„ç†è¿‡ç¨‹å’Œ Consumer è¯»å– Compacted æ•°æ®ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><h4 id="Compaction-å¤„ç†"><a href="#Compaction-å¤„ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#Compaction-å¤„ç†" class="headerlink" title="Compaction å¤„ç†"></a>Compaction å¤„ç†</h4><p>è§¦å‘ Compaction çš„ç»Ÿä¸€å…¥å£æ˜¯<code>Compactor.compact(String topic)</code>æ–¹æ³•ï¼Œ<code>Compactor</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç›®å‰çš„å®ç°åªæœ‰<code>TwoPhaseCompactor</code>ä¸€ç§ï¼Œä¸‹é¢ä»‹ç»çš„æ˜¯<code>TwoPhaseCompactor</code>çš„å®ç°é€»è¾‘ã€‚é¡¾åæ€ä¹‰ï¼ŒCompaction è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œéå†ä¸¤æ¬¡ Topic å†…å®¹ï¼Œç¬¬ä¸€æ¬¡éå†ç”¨æ¥è·å–æ¯ä¸ª key ä¸­æœ€æ–°çš„ MessageIdï¼ˆç›¸å½“äº Kafka ä¸­çš„ offsetï¼‰ï¼Œç¬¬äºŒæ¬¡éå†æ ¹æ®ç¬¬ä¸€æ¬¡éå†å–å¾—çš„ç»“æœï¼Œåªå°†æ¯ä¸ª key çš„æœ€æ–°æ¶ˆæ¯å†™å…¥æ–°çš„ Ledger ä¸­ã€‚</p><h4 id="è¯»å–-Compacted-æ•°æ®"><a href="#è¯»å–-Compacted-æ•°æ®" class="heading-link"><i class="fas fa-link"></i></a><a href="#è¯»å–-Compacted-æ•°æ®" class="headerlink" title="è¯»å– Compacted æ•°æ®"></a>è¯»å– Compacted æ•°æ®</h4><p>å¦‚æœ Consumer å¸Œæœ›è¯»å– Compacted æ•°æ®ï¼Œéœ€è¦åœ¨åˆå§‹åŒ–æ—¶åˆ¶å®šç›¸å…³é…ç½®ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Consumer&lt;<span class="keyword">byte</span>[]&gt; compactedTopicConsumer = client.newConsumer()</span><br><span class="line">        .topic(<span class="string">&quot;some-compacted-topic&quot;</span>)</span><br><span class="line">        .readCompacted(<span class="keyword">true</span>)</span><br><span class="line">        .subscribe();</span><br></pre></td></tr></table></div></figure><p>Broker åœ¨æ”¶åˆ° Consumer çš„è¯·æ±‚åï¼Œä¼šå…ˆè·å–åˆ° Topic å¯¹åº”çš„ cursor ä¿¡æ¯ï¼Œç„¶åä» cursor ä¿¡æ¯ä¸­æ‰¾åˆ° Compacted æ•°æ®å¯¹åº”çš„ LedgerIdï¼Œç„¶åè¿›è¡Œå¯¹åº”æ•°æ®çš„è¯»å–ã€‚</p><h4 id="Compacted-Leger-ä¿¡æ¯å¦‚ä½•ä¼ é€’ç»™-Consumerï¼Ÿ"><a href="#Compacted-Leger-ä¿¡æ¯å¦‚ä½•ä¼ é€’ç»™-Consumerï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a><a href="#Compacted-Leger-ä¿¡æ¯å¦‚ä½•ä¼ é€’ç»™-Consumerï¼Ÿ" class="headerlink" title="Compacted Leger ä¿¡æ¯å¦‚ä½•ä¼ é€’ç»™ Consumerï¼Ÿ"></a>Compacted Leger ä¿¡æ¯å¦‚ä½•ä¼ é€’ç»™ Consumerï¼Ÿ</h4><p>å¦‚å‰æ–‡æ‰€è¯´ï¼Œåœ¨<code>TwoPhaseCompactor</code>å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå®é™…æ˜¯åˆ›å»ºäº†ä¸€ä¸ª Subscription æ¥è¯»å–åŸæ¥çš„æ•°æ®ã€‚åœ¨è¯»å–æ•°æ®å®Œæˆè¿›è¡Œ Ack æ—¶ï¼Œä½¿ç”¨çš„æ¥å£æ˜¯<code>RawReader.acknowledgeCumulativeAsync(MessageId messageId, Map&lt;String, Long&gt; properties)</code>ï¼Œè¯¥æ¥å£å¯ä»¥åœ¨ Ack çš„åŒæ—¶ç»™ Broker è¿”å›ä¸€äº›è¯¥ Subscription çš„å…ƒä¿¡æ¯ï¼ŒBroker ä¼šå°†æ”¶åˆ°çš„å…ƒä¿¡æ¯è®°å½•åœ¨ cursor ä¿¡æ¯ä¸­ã€‚æ‰€ä»¥ï¼Œ<code>TwoPhaseCompactor</code>é€šè¿‡è¿™ä¸€èƒ½åŠ›ï¼Œå°†åˆ›å»ºçš„ç”¨æ¥å­˜å‚¨ Compacted æ•°æ®çš„ LedgerId è®°å½•åœ¨äº† cursor ä¿¡æ¯ä¸­ï¼Œæ–¹ä¾¿ Consumer è¯»å–æ—¶ä½¿ç”¨ã€‚</p><h2 id="æ€»ç»“æ€è€ƒ"><a href="#æ€»ç»“æ€è€ƒ" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“æ€è€ƒ" class="headerlink" title="æ€»ç»“æ€è€ƒ"></a>æ€»ç»“æ€è€ƒ</h2><p>Kafka å’Œ Pulsar ä¸­å®ç° Compaction çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹å‡å°‘ Topic çš„æ•°æ®é‡ï¼ŒåŠ å¿«è·å– Topic ä¸­å…¨éƒ¨æ•°æ®çš„é€Ÿåº¦ï¼Œè€Œä¸æ˜¯å¸Œæœ›å®ç°ç±»ä¼¼ KV å­˜å‚¨çš„èƒ½åŠ›ã€‚ä¹‹æ‰€ä»¥è¿™æ ·è¯´ï¼Œæ˜¯å› ä¸ºï¼š</p><ol><li>Kafka å’Œ Pulsar éƒ½æ²¡æœ‰ä¿è¯æœ€æ–°æ•°æ®çš„ Compactionï¼šå¯¹äº Kafka æ¥è¯´ï¼ŒLog Compaction åªä¼šæ“ä½œ ActiveSegment ä¹‹å‰çš„æ•°æ®ï¼›å¯¹äº Pulsar æ¥è¯´ï¼ŒCompaction æ˜¯ä¸€ä¸ªå‘¨æœŸæ€§æ‰§è¡Œçš„å·¥ä½œï¼Œæ¯æ¬¡ Compaction å¼€å§‹ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆè¯»å–å½“å‰ Topic ä¸­æœ€åä¸€ä¸ª MessageId ä½œä¸ºæœ¬è½® Compaction çš„ç»ˆç‚¹ï¼Œå› æ­¤åªè¦æœ‰ Producer åœ¨å‘ Topic ç”Ÿäº§æ•°æ®ã€‚å°±è‚¯å®šä¸èƒ½ä¿è¯æ‰€æœ‰æ•°æ®éƒ½è¢« Compactedã€‚</li><li>Kafka å’Œ Pulsar çš„ Compaction éƒ½æ˜¯ä¸€å®šèŒƒå›´å†…çš„ï¼Œä¸æ˜¯å…¨å±€çš„ï¼šKafka å’Œ Pulsar çš„ Compaction éƒ½æ˜¯ä»¥ä¸€ç§ç±»ä¼¼äºæ»‘åŠ¨çª—å£çš„è¿‡ç¨‹è¿›è¡Œï¼Œâ€œkey ç›¸åŒçš„æƒ…å†µä¸‹åªä¿ç•™æœ€æ–°çš„æ¶ˆæ¯â€é’ˆå¯¹çš„æ˜¯ä¸€è½® Compaction å†…ï¼Œå¦‚æœä¸¤è½® Compaction ä¸­æœ‰ç›¸åŒ key çš„æ¶ˆæ¯ï¼Œæ˜¯æ²¡æœ‰åŠæ³•åˆå¹¶çš„ã€‚</li></ol><p>å¯¹æ¯” Kafka å’Œ Pulsar ä¸¤è€…çš„å®ç°æ¥çœ‹ï¼Œæœ€ä¸»è¦çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦ä¿ç•™ Compaction å‰çš„æ•°æ®ã€‚ç›¸è¾ƒäº Kafka çš„å®ç°ï¼ŒPulsar è¿™ç§å½¢å¼ä¸€æ–¹é¢æ•´ä½“é€»è¾‘æ›´ä¸ºç®€å•ï¼Œä¸éœ€è¦è€ƒè™‘å„ç§æ–‡ä»¶æ›¿æ¢è¿‡ç¨‹ä¸­çš„å´©æºƒæ¢å¤é€»è¾‘ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥ç»™ Consumer æ›´å¤šé€‰æ‹©çš„ç©ºé—´ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„å­˜å‚¨æˆæœ¬ã€‚ä¸¤è€…çš„å®ç°æ¶æ„æ˜¯ä¸åŒçš„ï¼Œå¦‚æœæƒ³è¦ Kafka ä¹Ÿåƒ Pulsar ä¸€æ ·ä¿ç•™ä¸¤ä»½æ•°æ®ï¼Œç”±äº Kafka çš„å­˜å‚¨å‰¯æœ¬æœºåˆ¶æ˜¯è‡ªå·±çš„ç®¡ç†çš„ï¼Œå¯èƒ½éœ€è¦æ¯”ç°åœ¨æ›´ä¸ºå¤æ‚çš„å®ç°æ‰èƒ½å¤Ÿæå®šï¼Œè€Œä¸èƒ½åƒ Pulsar ä¸€æ ·ç›´æ¥é€šè¿‡åˆ‡æ¢ LedgerId æ¥é€‰æ‹©æ•°æ®å°±å¯ä»¥äº†ã€‚</p></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/03/29/Kafka-%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE/">Kafka æºç å­¦ä¹ ï¼šåŠ¨æ€é…ç½®</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2022-03-29</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2022-04-02</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>Kafka çš„åŠ¨æ€é…ç½®åŸºäº Zookeeper å®ç°ï¼Œæœ¬æ–‡ä¸»è¦æ¢³ç†äº† Kafkaï¼ˆversionï¼š2.8ï¼‰ ä¸­åŠ¨æ€é…ç½®çš„å®ç°é€»è¾‘ã€‚</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2022/03/29/Kafka-%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%9A%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/20/Kafka-%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%9A%E6%97%A5%E5%BF%97%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">Kafka æºç å­¦ä¹ ï¼šæ—¥å¿—åŠ è½½ä¸æ¢å¤</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2022-02-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2022-02-20</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>æœ¬æ–‡æ¢³ç†ä¸»è¦æ¢³ç† Kafka æ—¥å¿—åŠ è½½ä¸æ¢å¤çš„æºç ã€‚ï¼ˆKafka ç‰ˆæœ¬ï¼š2.8ï¼‰</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2022/02/20/Kafka-%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%9A%E6%97%A5%E5%BF%97%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/12/25/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%8D%81%E4%BA%8C%E6%9C%88%E4%B9%A6%E5%8D%95/">äºŒé›¶äºŒä¸€å¹´åäºŒæœˆä¹¦å•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-12-25</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-12-25</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>ä¸€å¹´å³å°†è¿‡å»ï¼Œä»ä¸ƒæœˆä»½è®°å½•ä»¥æ¥ï¼Œè¯»äº† 28 æœ¬ä¹¦ï¼ŒæŒ‰ç…§è¿™ä¸ªé€Ÿåº¦ï¼Œæ˜å¹´çš„æœ€ä½ç›®æ ‡å¾—æ˜¯ 50 æœ¬ï¼ŒåŠ æ²¹åŠ æ²¹ï¼ğŸ’ªğŸ»ğŸ’ªğŸ»ğŸ’ªğŸ»</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/12/25/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%8D%81%E4%BA%8C%E6%9C%88%E4%B9%A6%E5%8D%95/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/12/04/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%8D%81%E4%B8%80%E6%9C%88%E4%B9%A6%E5%8D%95/">äºŒé›¶äºŒä¸€å¹´åä¸€æœˆä¹¦å•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-12-04</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-12-04</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>æœ‰ç‚¹è¿Ÿåˆ°ï¼Œå†²å†²å†²ï¼</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/12/04/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%8D%81%E4%B8%80%E6%9C%88%E4%B9%A6%E5%8D%95/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/10/31/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%8D%81%E6%9C%88%E4%B9%A6%E5%8D%95/">äºŒé›¶äºŒä¸€å¹´åæœˆä¹¦å•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-10-31</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-12-04</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>åä¸€é•¿å‡åŠ ä¼‘å‡çš„ä¸€ä¸ªæœˆï¼Œè¯»ä¹¦é‡å˜å°‘äº†ğŸ¶ã€‚</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/10/31/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%8D%81%E6%9C%88%E4%B9%A6%E5%8D%95/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/10/03/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E4%B9%9D%E6%9C%88%E4%B9%A6%E5%8D%95/">äºŒé›¶äºŒä¸€å¹´ä¹æœˆä¹¦å•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-10-03</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-10-03</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>å›½åº†å‡æœŸè¡¥ä¸Šäº†ç¬¬ä¸‰ç¯‡ä¹¦å•ã€‚</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/10/03/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E4%B9%9D%E6%9C%88%E4%B9%A6%E5%8D%95/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/08/28/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%85%AB%E6%9C%88%E4%B9%A6%E5%8D%95/">äºŒé›¶äºŒä¸€å¹´å…«æœˆä¹¦å•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-08-28</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-08-28</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>ç¬¬äºŒç¯‡ä¹¦å•å¦‚æœŸè€Œè‡³ã€‚</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/08/28/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E5%85%AB%E6%9C%88%E4%B9%A6%E5%8D%95/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/08/15/kafka%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86%E5%BC%95%E5%8F%91%E7%9A%84core-dump%E9%97%AE%E9%A2%98/">kafkaæ—¥å¿—æ¸…ç†å¼•å‘çš„core dumpé—®é¢˜</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-08-15</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-08-15</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>â€‹ å›¢é˜Ÿå¼€å‘äº†kafka on hdfsçš„åŠŸèƒ½ï¼Œç”¨ä»¥å°†kafkaæ•°æ®å­˜å‚¨åœ¨hdfsä¸Šï¼Œä½†æ˜¯åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œæœ‰æœºå™¨å‡ºç°core dumpç°è±¡ã€‚</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/08/15/kafka%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86%E5%BC%95%E5%8F%91%E7%9A%84core-dump%E9%97%AE%E9%A2%98/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/08/15/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E4%B8%83%E6%9C%88%E4%B9%A6%E5%8D%95/">äºŒé›¶äºŒä¸€å¹´ä¸ƒæœˆä¹¦å•</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2021-08-15</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2021-08-15</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>â€‹ è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€æ¬¡ä¹¦å•æ€»ç»“ï¼Œå¸Œæœ›ä»¥åæ¯ä¸ªæœˆéƒ½èƒ½æœ‰ä¸€æ¬¡ä¹¦å•æ€»ç»“å°†è‡ªå·±è¯»è¿‡çš„ä¹¦è®°å½•ä¸‹æ¥ã€‚</p></div><div class="post-readmore"><a class="post-readmore__link" href="/2021/08/15/%E4%BA%8C%E9%9B%B6%E4%BA%8C%E4%B8%80%E5%B9%B4%E4%B8%83%E6%9C%88%E4%B9%A6%E5%8D%95/"><span class="post-readmore__text">é˜…è¯»å…¨æ–‡</span><span class="post-readmore__icon"><i class="fas fa-long-arrow-alt-right"></i></span></a></div></div></article></section><nav class="paginator"><div class="paginator-inner"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/uploads/avatar.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">æ—¢ç„¶ç”Ÿæ´»è¿™ä¹ˆè‹¦ï¼Œé‚£è¿˜ä¸ç¬‘ä¸€ç¬‘è®©è‡ªå·±å¼€å¿ƒä¸€ç‚¹ã€‚</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/fxbing" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">18</div><div class="sidebar-ov-state-item__name">å½’æ¡£</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">8</div><div class="sidebar-ov-state-item__name">æ ‡ç­¾</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="çŸ¥è¯†å…±äº«è®¸å¯åè®®" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>fxbing</span></div><div><span>ç”± <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨</span><span> v5.4.0</span><span class="footer__devider">|</span><span>ä¸»é¢˜ - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>